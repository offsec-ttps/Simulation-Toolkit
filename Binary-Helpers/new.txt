Observations:

    When a local user is added or removed from a local or global security group, the user is incorrectly assigned as a MemberName due to improper resolution or translation of the account name.
    After making changes to the parameters below, Splunk alerts were triggered:
        dest_user != "-" was changed to dest_user = "-".
        nt_domain IN ("EUR", "AME") was changed to rc_nt_domain IN ("EUR", "AST", "AME").
    Splunk queries are excluding the detection of improper resolution or translation of the account name, which bypasses the intended detection mechanism for local user creation or removal from security-enabled local, global, or universal groups.

Reason for Failures:

    The system is unable to detect when a local user is added or removed from a security group because the user is incorrectly assigned as a MemberName due to improper resolution or translation of the account name.
    Due to the exclusion of dest_user != "-", Splunk queries are not able to detect the alerts related to local user changes.





    Three methods have been developed for KrbRelayUp exploitation:
        RBCD (Resource-Based Constrained Delegation)
        ShadowCred
        ADCS (Active Directory Certificate Services)

    RBCD: When exploited, logon type = 9 is generated.

    ShadowCred: When exploited, logon type = [missing logon type value] is generated.

    ADCS: When exploited, logon type = [missing logon type value] is generated.

    Splunk queries are detecting five key parameters:
        Authentication.method
        dest_sid
        logontype
        signature_id
        src_ip

Reasons for Failures:

    Kerberos Authentication:
        Kerberos authentication typically uses a Service Principal Name (SPN) and a ticket to authenticate users. Because of this, the username or SID may not be directly visible in the event logs, making it difficult to detect dest_sid during Kerberos authentication.
    Logon Type Mismatch:
        During RBCD exploitation, logon type = 9 is generated, but the signature currently uses logon type = 3, causing a mismatch. This needs to be fixed in the signature for proper detection.

 Recommendations:
Monitor Kerberos Authentication Events: Track Kerberos-related event IDs, such as:

Event ID 4768: A Kerberos authentication ticket (TGT) request was made.
Event ID 4769: A Kerberos service ticket request was made.
Event ID 4770: A Kerberos service ticket renewal request was made.
Enable LDAP Security Features: Microsoft recommends configuring LDAP signing and LDAP channel binding to prevent certain attacks. Implement the following:

KB935834: Enable LDAP signing.
KB4034879: Enable LDAP channel binding.
Set ms-DS-MachineAccountQuota to 0: Prevent non-admin users from adding new devices to the domain by setting the ms-DS-MachineAccountQuota attribute to 0, reducing the risk of unauthorized device additions.
